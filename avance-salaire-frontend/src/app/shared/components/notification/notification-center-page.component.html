<div class="notification-center-page">
  <!-- Header -->
  <div class="notif-header">
    <h2 style="color: #fff;">Centre de Notifications</h2>
    <div class="notif-stats">
      <div class="stat-item">
        <i class="fas fa-circle" style="color: #f39c12; font-size: 0.7rem;"></i>
        <span>{{ unreadCount }} non lues</span>
      </div>
      <div class="stat-item">
        <i class="fas fa-circle" style="color: #2ecc71; font-size: 0.7rem;"></i>
        <span>{{ notifications.length }} total</span>
      </div>
    </div>
  </div>

  <!-- Filtres -->
  <div class="notif-filters">
    <div class="filter-group">
      <label for="searchInput"><i class="fas fa-search"></i></label>
      <input type="text" id="searchInput" placeholder="Rechercher..." [(ngModel)]="search" (ngModelChange)="setSearch($event)">
    </div>
    <div class="filter-group">
      <label for="typeFilter">Type :</label>
      <select id="typeFilter" [(ngModel)]="typeFilter" (ngModelChange)="setTypeFilter($event)">
        <option value="">Tous les types</option>
        <option value="INFO">Information</option>
        <option value="WARNING">Avertissement</option>
        <option value="ERROR">Erreur</option>
        <option value="POSITIVE_FEEDBACK">Succès</option>
        <option value="ACTION_REMINDER">Rappel</option>
      </select>
    </div>
    <div class="checkbox-wrapper">
      <input type="checkbox" id="onlyUnread" [(ngModel)]="onlyUnread" (change)="setOnlyUnread($event)">
      <label for="onlyUnread">Non lues uniquement</label>
    </div>
    <div style="margin-left: auto;">
      <button class="btn" (click)="markAllAsRead()">
        <i class="fas fa-check-double"></i> Tout marquer comme lu
      </button>
    </div>
  </div>

  <!-- Bulk actions -->
  <div class="bulk-actions" [class.active]="selectedNotifications.size > 0">
    <div class="bulk-actions-text">
      <span>{{ selectedNotifications.size }}</span> notification(s) sélectionnée(s)
    </div>
    <button class="btn-primary" (click)="markSelectedAsRead()">
      <i class="fas fa-check"></i> Marquer comme lu
    </button>
    <button class="btn-icon" (click)="deleteSelected()">
      <i class="fas fa-trash"></i>
    </button>
    <button class="btn-icon" (click)="clearSelection()">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <!-- Select all -->
  <div class="select-all-checkbox">
    <input type="checkbox" id="selectAll" [checked]="allSelected()" (change)="toggleSelectAll($event)">
    <label for="selectAll" style="margin-left: 0.5rem; font-size: 0.9rem; color: #5a6c7d;">Sélectionner tout</label>
  </div>

  <!-- Liste des notifications -->
  <div class="notif-list">
    <div *ngIf="filtered.length === 0" class="notif-empty">
      <i class="fas fa-bell-slash"></i>
      <h3>Aucune notification</h3>
      <p>Aucune notification ne correspond à vos critères de recherche.</p>
    </div>
    <div *ngFor="let notif of filtered | slice:(page-1)*pageSize:(page)*pageSize" class="notif-row" [class.unread]="!notif.read">
      <input type="checkbox" class="notif-checkbox" [checked]="selectedNotifications.has(notif.id)" (change)="handleNotificationSelect(notif.id, $event)" style="margin-right: 1rem;">
      <div class="notif-main">
        <div class="notif-avatar" [ngClass]="notif.senderType?.toLowerCase()">
          <ng-container *ngIf="notif.senderProfilePicture; else initials">
            <img [src]="notif.senderProfilePicture" alt="avatar" style="width:100%;height:100%;border-radius:50%;object-fit:cover;" />
          </ng-container>
          <ng-template #initials>
            <ng-container [ngSwitch]="notif.senderType">
              <span *ngSwitchCase="'SYSTEM'">S</span>
              <span *ngSwitchCase="'RH'">RH</span>
              <span *ngSwitchCase="'EMPLOYEE'">{{ getInitials(notif.senderName || 'Employé') }}</span>
              <span *ngSwitchDefault>{{ getInitials(notif.senderName || 'Système') }}</span>
            </ng-container>
          </ng-template>
          <span class="notif-type-circle" [ngClass]="notif.type.toLowerCase()">
            <ng-container *ngIf="notif.type === 'POSITIVE_FEEDBACK'; else typeIcon">
              <i class="fas fa-heart" style="color:#e74c3c;"></i>
            </ng-container>
            <ng-template #typeIcon></ng-template>
          </span>
        </div>
        <div class="notif-content">
          <div class="notif-title">{{ notif.title }}</div>
          <div class="notif-message">{{ notif.message }}</div>
          <div class="notif-meta">
            <span><i class="fas fa-user"></i> {{ notif.senderName || 'Système' }}</span>
            <span><i class="fas fa-clock"></i> {{ notif.createdAt | date:'short' }}</span>
          </div>
        </div>
      </div>
      <div class="notif-actions">
        <button class="btn-primary" *ngIf="!notif.read" (click)="markAsRead(notif)">
          <i class="fas fa-check"></i> Marquer comme lu
        </button>
        <button class="btn-icon" (click)="showDetails(notif)">
          <i class="fas fa-info-circle"></i>
        </button>
        <button class="btn-icon" (click)="deleteNotification(notif)">
          <i class="fas fa-trash"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="notif-pagination">
    <div class="pagination-info">
      Affichage de {{ (page-1)*pageSize+1 }}-{{ getPageEnd() }} sur {{ filtered.length }} notifications
    </div>
    <div class="pagination-controls">
      <button class="page-btn" (click)="goToPage(page-1)" [disabled]="page === 1">
        <i class="fas fa-chevron-left"></i>
      </button>
      <ng-container *ngFor="let p of [].constructor(getTotalPages()); let i = index">
        <button class="page-btn" [class.active]="page === i+1" (click)="goToPage(i+1)">{{ i+1 }}</button>
      </ng-container>
      <button class="page-btn" (click)="goToPage(page+1)" [disabled]="page === getTotalPages()">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>
</div>