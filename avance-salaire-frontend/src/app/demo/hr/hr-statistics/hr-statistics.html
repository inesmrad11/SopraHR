<!-- Dashboard moderne avec design light et dégradés lumineux -->
<div class="light-dashboard">
  <!-- Header identique à employee-home -->
  <div class="welcome-banner" [ngStyle]="{'background-image': 'url(' + welcomeImage + ')'}">
    <div class="welcome-banner-overlay"></div>
    <div class="welcome-banner-content">
      <div class="welcome-banner-text">
        <div class="welcome-date">{{ frenchDate }}</div>
        <div class="welcome-greeting">Bonjour, <b>{{ userFullName }}</b></div>
        <div class="welcome-description">Gérez les demandes d'avance de salaire et suivez les performances intelligemment.</div>
      </div>
      <div class="welcome-banner-actions">
        <button class="action-btn search-btn">
          <i antIcon type="search" theme="outline"></i>
        </button>
        <button class="action-btn notification-btn">
          <i antIcon type="bell" theme="outline"></i>
          <span class="notification-badge"></span>
        </button>
        <button class="export-btn">
          <i antIcon type="download" theme="outline"></i>
          Exporter
        </button>
      </div>
    </div>
  </div>

  <!-- Cartes de statistiques avec vraies images -->
  <div class="stats-grid">
    <!-- Carte 1: Demandes totales -->
    <div class="stat-card total-requests">
      <img [src]="cardImages[0]" class="card-bg-img" alt="Stat BG" />
      <div class="card-overlay"></div>
      <div class="card-header">
        <div class="card-icon">
          <i antIcon type="file-text" theme="outline"></i>
          Demandes totales
        </div>
        <div class="card-trend positive">+12.4%</div>
      </div>
      <div class="card-value">{{ widgets[0]?.valeur || '0' }}</div>
      <div class="card-actions">
        <button class="view-details">Voir détails</button>
        <button class="action-icon">
          <i antIcon type="arrow-right" theme="outline"></i>
        </button>
      </div>
    </div>

    <!-- Carte 2: Demandes validées -->
    <div class="stat-card approved-requests">
      <img [src]="cardImages[1]" class="card-bg-img" alt="Stat BG" />
      <div class="card-overlay"></div>
      <div class="card-header">
        <div class="card-icon">
          <i antIcon type="check-circle" theme="outline"></i>
          Demandes validées
        </div>
        <div class="card-trend positive">+18.7%</div>
      </div>
      <div class="card-value">{{ widgets[1]?.valeur || '0' }}</div>
      <div class="card-actions">
        <button class="view-details">Voir détails</button>
        <button class="action-icon">
          <i antIcon type="arrow-right" theme="outline"></i>
        </button>
      </div>
    </div>

    <!-- Carte 3: Montant total -->
    <div class="stat-card total-amount">
      <img [src]="cardImages[2]" class="card-bg-img" alt="Stat BG" />
      <div class="card-overlay"></div>
      <div class="card-header">
        <div class="card-icon">
          <i antIcon type="dollar" theme="outline"></i>
          Montant total demandé
        </div>
        <div class="card-trend positive">+7.1%</div>
      </div>
      <div class="card-value">{{ widgets[4]?.valeur || '0 TND' }}</div>
      <div class="card-actions">
        <button class="view-details">Voir détails</button>
        <button class="action-icon">
          <i antIcon type="arrow-right" theme="outline"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Graphiques -->
  <div class="charts-grid">
    <!-- Graphique d'évolution -->
    <div class="chart-card">
      <div class="chart-header">
        <div class="chart-title">
          <i antIcon type="rise" theme="outline"></i>
          Évolution des demandes
        </div>
        <button class="chart-action">Analyse</button>
      </div>
      <div class="chart-content">
        <ng-container *ngIf="trends.length">
          <apx-chart
            [series]="[{ name: 'Demandes', data: trends }]"
            [chart]="{ type: 'line', height: 250, background: 'transparent' }"
            [xaxis]="{ categories: ['M-5', 'M-4', 'M-3', 'M-2', 'M-1', 'M'] }"
            [colors]="['#8b5cf6']"
            [stroke]="{ curve: 'smooth', width: 3 }"
            [dataLabels]="{ enabled: false }"
            [grid]="{ borderColor: '#e9ecef', strokeDashArray: 4 }"
            [theme]="{ mode: 'light' }"
          ></apx-chart>
        </ng-container>
        <ng-container *ngIf="!trends.length">
          <div class="no-data">Aucune donnée disponible</div>
        </ng-container>
      </div>
    </div>

    <!-- Graphique de répartition -->
    <div class="chart-card">
      <div class="chart-header">
        <div class="chart-title">
          <i antIcon type="pie-chart" theme="outline"></i>
          Répartition des statuts
        </div>
      </div>
      <div class="chart-content">
        <ng-container *ngIf="statusDistribution.length">
          <apx-chart
            [series]="statusDistribution"
            [labels]="['Validées', 'Rejetées', 'En attente']"
            [chart]="{ type: 'pie', height: 250, background: 'transparent' }"
            [colors]="['#1cc88a', '#e74a3b', '#f6c23e']"
            [theme]="{ mode: 'light' }"
          ></apx-chart>
        </ng-container>
        <ng-container *ngIf="!statusDistribution.length">
          <div class="no-data">Aucune donnée disponible</div>
        </ng-container>
      </div>
    </div>
  </div>

  <!-- Tableau des alertes -->
  <div class="alerts-section">
    <div class="alerts-header">
      <h2 class="alerts-title">Demandes récentes</h2>
      <button class="filters-btn">
        <i antIcon type="filter" theme="outline"></i>
        Filtres intelligents
      </button>
    </div>
    <div class="alerts-table">
      <table class="table">
        <thead>
          <tr>
            <th>Employé</th>
            <th>Montant</th>
            <th>Statut</th>
            <th>Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (req of recentRequests; track req) {
            <tr class="table-row">
              <td class="employee-cell">
                <div class="employee-info">
                  <div class="employee-avatar">
                    <img [src]="getAvatarUrl(req.employeeEmail, req.employeeFullName, req.employeeProfilePicture)" 
                         (error)="onImageError($event)" 
                         alt="Avatar">
                  </div>
                  <span class="employee-name">{{ req.employeeFullName }}</span>
                </div>
              </td>
              <td class="amount-cell">{{ req.requestedAmount }} TND</td>
              <td class="status-cell">
                <span class="status-badge" [ngClass]="{
                  'status-pending': req.status === 'PENDING',
                  'status-approved': req.status === 'APPROVED',
                  'status-rejected': req.status === 'REJECTED'
                }">
                  {{ req.status === 'PENDING' ? 'En attente' : req.status === 'APPROVED' ? 'Approuvée' : 'Rejetée' }}
                </span>
              </td>
              <td class="date-cell">{{ req.requestDate | date:'shortDate' }}</td>
              <td class="actions-cell">
                <button class="action-btn" title="Voir détails">
                  <i antIcon type="eye" theme="outline"></i>
                </button>
                <button class="action-btn" title="Modifier">
                  <i antIcon type="edit" theme="outline"></i>
                </button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>

  <!-- Métriques supplémentaires -->
  <div class="metrics-grid">
    <div class="metric-card">
      <div class="metric-header">
        <i antIcon type="tag" theme="outline"></i>
        <span>Taux d'approbation</span>
      </div>
      <div class="metric-value">{{ (approvalRate * 100) | number:'1.0-0' }}%</div>
      <div class="metric-progress">
        <div class="progress-bar" [style.width]="(approvalRate * 100) + '%'"></div>
      </div>
    </div>

    <div class="metric-card">
      <div class="metric-header">
        <i antIcon type="clock" theme="outline"></i>
        <span>Temps moyen de traitement</span>
      </div>
      <div class="metric-value">2.3 jours</div>
      <div class="metric-trend positive">-15% vs mois dernier</div>
    </div>

    <div class="metric-card">
      <div class="metric-header">
        <i antIcon type="warning" theme="outline"></i>
        <span>Demandes urgentes</span>
      </div>
      <div class="metric-value">{{ widgets[2]?.valeur || '0' }}</div>
      <div class="metric-trend negative">+8% vs mois dernier</div>
    </div>
  </div>
</div>
  